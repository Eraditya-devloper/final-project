<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Snake - A Classic Arcade Game</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Press Start 2P & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark Blue/Gray Background */
            color: #f0f0f0;
        }
        .font-game {
            font-family: 'Press Start 2P', cursive;
        }
        /* Animated Gradient for Hero */
        .hero-gradient {
            background: linear-gradient(45deg, #1e3a8a, #4c1d95, #111827);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        /* Game Styles */
        .game-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 2rem;
        }
        .game-container {
            position: relative;
            width: 408px; /* Canvas width + borders */
            height: 408px; /* Canvas height + borders */
            border: 4px solid #4a4a4a;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background-color: #000;
        }
        canvas {
            display: block;
            border-radius: 4px;
        }
        .stats-container {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            width: 200px;
            height: 408px;
            font-size: 1.2rem;
            background-color: #0a0a0a;
            border: 4px solid #4a4a4a;
            border-radius: 8px;
            padding: 20px;
            box-sizing: border-box;
        }
        .stats-container span { color: #facc15; }
        .stats-container #level { color: #60a5fa; }
        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-radius: 4px;
        }
        .screen h2 { font-size: 2rem; margin-bottom: 10px; }
        .screen p { margin-bottom: 20px; }
        .btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            padding: 12px 24px;
            border: 2px solid #000;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.2s, background-color 0.2s;
            box-shadow: 3px 3px 0 #000;
            margin-top: 10px;
        }
        #restartButton, #changeDifficultyBtn { background-color: #4ade80; color: #1a1a1a; }
        #restartButton:hover, #changeDifficultyBtn:hover { background-color: #86efac; transform: translateY(-2px); }
        .difficulty-btn { background-color: #60a5fa; color: #1a1a1a; width: 200px; }
        .difficulty-btn:hover { background-color: #93c5fd; transform: translateY(-2px); }
        #pauseBtn { font-size: 0.8rem; padding: 8px 16px; background-color: #facc15; color: #1a1a1a; margin-top: 0; }
        #pauseBtn:hover { background-color: #fde047; }

        /* On-Screen Controls */
        #touchControls {
            display: none; /* Hidden by default */
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 180px;
            height: 180px;
            margin-top: 20px;
        }
        .control-btn {
            background-color: #4a4a4a;
            border: 2px solid #333;
            border-radius: 12px;
            color: white;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        #up { grid-area: 1 / 2 / 2 / 3; }
        #left { grid-area: 2 / 1 / 3 / 2; }
        #right { grid-area: 2 / 3 / 3 / 4; }
        #down { grid-area: 3 / 2 / 4 / 3; }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .game-wrapper { flex-direction: column; align-items: center; }
            .stats-container { flex-direction: row; width: 100%; max-width: 408px; height: auto; }
            #touchControls { display: grid; } /* Show controls on mobile */
        }
    </style>
</head>
<body class="text-gray-200">

    <!-- Hero Section -->
    <section class="hero-gradient text-center py-20 md:py-32">
        <div class="container mx-auto px-6">
            <h1 class="font-game text-4xl md:text-6xl text-white uppercase tracking-wider">Retro Snake</h1>
            <p class="text-lg md:text-xl text-gray-300 mt-4 max-w-2xl mx-auto">The classic arcade game is back! Guide the snake, eat the apples, and see how long you can grow.</p>
            <a href="#game-section" class="inline-block mt-8 bg-green-500 hover:bg-green-600 text-white font-game py-3 px-8 rounded-lg text-lg transition-transform duration-200 hover:scale-105">Play Now</a>
        </div>
    </section>

    <!-- Instructions Section -->
    <section class="py-16 bg-gray-800">
        <div class="container mx-auto px-6 text-center">
            <h2 class="font-game text-3xl text-white mb-8">How to Play</h2>
            <div class="flex flex-wrap justify-center gap-8">
                <div class="max-w-xs">
                    <h3 class="text-xl font-bold text-green-400 mb-2">Objective</h3>
                    <p class="text-gray-400">Eat as many apples as you can to grow your snake and increase your score.</p>
                </div>
                <div class="max-w-xs">
                    <h3 class="text-xl font-bold text-green-400 mb-2">Controls</h3>
                    <p class="text-gray-400">Use <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-lg">Arrow Keys</kbd> on desktop or the <span class="font-bold">on-screen buttons</span> on mobile. Press <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-lg">ESC</kbd> to pause.</p>
                </div>
                <div class="max-w-xs">
                    <h3 class="text-xl font-bold text-green-400 mb-2">Avoid</h3>
                    <p class="text-gray-400">Don't run into the walls or your own tail, or the game is over!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Game Section -->
    <section id="game-section" class="py-16">
        <div class="container mx-auto px-6 flex flex-col items-center">
            <div class="game-wrapper">
                <div class="game-container">
                    <canvas id="gameCanvas" width="400" height="400"></canvas>
                    <div id="difficultyScreen" class="screen">
                        <h2 class="font-game">Choose Difficulty</h2>
                        <button class="btn difficulty-btn" data-speed="150">Easy</button>
                        <button class="btn difficulty-btn" data-speed="110">Medium</button>
                        <button class="btn difficulty-btn" data-speed="80">Hard</button>
                    </div>
                    <div id="pauseScreen" class="screen" style="display: none;">
                        <h2 class="font-game">Paused</h2>
                        <p>Press ESC or the button to resume</p>
                    </div>
                    <div id="gameOverScreen" class="screen" style="display: none;">
                        <h2 class="font-game" style="color: #ef4444;">Game Over</h2>
                        <p id="finalScore"></p>
                        <p id="finalLevel"></p>
                        <button id="restartButton" class="btn">Restart</button>
                        <button id="changeDifficultyBtn" class="btn">Change Difficulty</button>
                    </div>
                </div>
                <div id="statsContainer" class="stats-container font-game" style="visibility: hidden;">
                    <div>SCORE: <span id="score">0</span></div>
                    <div>LEVEL: <span id="level">1</span></div>
                    <button id="pauseBtn" class="btn">Pause</button>
                </div>
            </div>
            <div id="touchControls">
                <div id="up" class="control-btn">↑</div>
                <div id="left" class="control-btn">←</div>
                <div id="right" class="control-btn">→</div>
                <div id="down" class="control-btn">↓</div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="bg-gray-900 text-center py-6">
        <p class="text-gray-500">&copy; 2024 Retro Snake. All Rights Reserved.</p>
    </footer>


    <script>
        // --- GAME SCRIPT ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const difficultyScreen = document.getElementById('difficultyScreen');
        const pauseScreen = document.getElementById('pauseScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const finalLevelElement = document.getElementById('finalLevel');
        const restartButton = document.getElementById('restartButton');
        const changeDifficultyBtn = document.getElementById('changeDifficultyBtn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const statsContainer = document.getElementById('statsContainer');
        const pauseBtn = document.getElementById('pauseBtn');
        const touchControls = document.getElementById('touchControls');

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;
        const LEVEL_UP_SCORE = 5;
        const SPEED_INCREMENT = 5;

        let snake, food, score, direction, dx, dy, isGameOver, isPaused, level, speed, initialSpeed, gameLoopId;

        function initializeGame() {
            snake = [{ x: 10, y: 10 }];
            placeFood();
            score = 0;
            scoreElement.textContent = score;
            level = 1;
            levelElement.textContent = level;
            speed = initialSpeed;
            direction = null; 
            dx = 0;
            dy = 0;
            isGameOver = false;
            isPaused = false;
            pauseBtn.textContent = 'Pause';

            gameOverScreen.style.display = 'none';
            difficultyScreen.style.display = 'none';
            pauseScreen.style.display = 'none';
            statsContainer.style.visibility = 'visible';
            // Touch controls are handled by CSS media queries

            startGameLoop();
        }

        function startGameLoop() {
            if (gameLoopId) clearInterval(gameLoopId);
            gameLoopId = setInterval(gameLoop, speed);
        }

        function gameLoop() {
            if (isGameOver || isPaused) return;
            update();
            draw();
        }

        function update() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreElement.textContent = score;
                placeFood();
                if (score > 0 && score % LEVEL_UP_SCORE === 0) {
                    levelUp();
                }
            } else {
                snake.pop();
            }

            if (isCollision(head)) {
                endGame();
            }
        }

        function levelUp() {
            level++;
            levelElement.textContent = level;
            speed = Math.max(40, speed - SPEED_INCREMENT);
            startGameLoop();
        }

        function draw() {
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            snake.forEach((segment, index) => {
                const segmentX = segment.x * gridSize;
                const segmentY = segment.y * gridSize;

                if (index === 0) {
                    ctx.fillStyle = '#34D399';
                    ctx.beginPath();
                    ctx.arc(segmentX + gridSize / 2, segmentY + gridSize / 2, gridSize / 2, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    const eyeSize = gridSize / 5;
                    let eye1X, eye1Y, eye2X, eye2Y;
                    if (dx === 1) { eye1X = segmentX + gridSize * 0.7; eye1Y = segmentY + gridSize * 0.3; eye2X = segmentX + gridSize * 0.7; eye2Y = segmentY + gridSize * 0.7; } 
                    else if (dx === -1) { eye1X = segmentX + gridSize * 0.3; eye1Y = segmentY + gridSize * 0.3; eye2X = segmentX + gridSize * 0.3; eye2Y = segmentY + gridSize * 0.7; } 
                    else if (dy === 1) { eye1X = segmentX + gridSize * 0.3; eye1Y = segmentY + gridSize * 0.7; eye2X = segmentX + gridSize * 0.7; eye2Y = segmentY + gridSize * 0.7; } 
                    else { eye1X = segmentX + gridSize * 0.3; eye1Y = segmentY + gridSize * 0.3; eye2X = segmentX + gridSize * 0.7; eye2Y = segmentY + gridSize * 0.3; }
                    ctx.beginPath(); ctx.arc(eye1X, eye1Y, eyeSize, 0, 2 * Math.PI); ctx.fill();
                    ctx.beginPath(); ctx.arc(eye2X, eye2Y, eyeSize, 0, 2 * Math.PI); ctx.fill();
                } else {
                    ctx.fillStyle = '#4ade80';
                    ctx.beginPath();
                    ctx.arc(segmentX + gridSize / 2, segmentY + gridSize / 2, gridSize / 2.2, 0, 2 * Math.PI);
                    ctx.fill();
                }
            });

            ctx.fillStyle = '#ef4444';
            ctx.strokeStyle = '#991b1b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2, gridSize / 2.5, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();
        }
        
        function togglePause() {
            if(isGameOver) return;
            isPaused = !isPaused;
            if (isPaused) {
                pauseScreen.style.display = 'flex';
                pauseBtn.textContent = 'Resume';
            } else {
                pauseScreen.style.display = 'none';
                pauseBtn.textContent = 'Pause';
                gameLoop();
            }
        }

        function placeFood() {
            let newFoodPosition;
            do {
                newFoodPosition = { x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount) };
            } while (isSnakeOn(newFoodPosition));
            food = newFoodPosition;
        }

        function isSnakeOn(position) {
            return snake.some(segment => segment.x === position.x && segment.y === position.y);
        }

        function isCollision(head) {
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) return true;
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) return true;
            }
            return false;
        }
        
        function endGame() {
            isGameOver = true;
            clearInterval(gameLoopId);
            finalScoreElement.textContent = `Your Score: ${score}`;
            finalLevelElement.textContent = `You Reached Level: ${level}`;
            gameOverScreen.style.display = 'flex';
        }

        function handleKeyPress(event) {
            const keyPressed = event.key;
            const arrowKeys = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
            
            // Determine if the game is in a playable state (not on a menu screen)
            const isGamePlayable = difficultyScreen.style.display === 'none' && !isGameOver;

            // 1. Handle Pause/Resume with Escape key
            if (keyPressed === 'Escape' && isGamePlayable) {
                event.preventDefault();
                togglePause();
                return;
            }

            // 2. Handle snake movement with Arrow keys
            // Only if the game is playable AND not paused
            if (arrowKeys.includes(keyPressed) && isGamePlayable && !isPaused) {
                event.preventDefault(); // Prevent scrolling ONLY during active gameplay

                if (keyPressed === 'ArrowUp' && direction !== 'DOWN') { direction = 'UP'; dx = 0; dy = -1; } 
                else if (keyPressed === 'ArrowDown' && direction !== 'UP') { direction = 'DOWN'; dx = 0; dy = 1; } 
                else if (keyPressed === 'ArrowLeft' && direction !== 'RIGHT') { direction = 'LEFT'; dx = -1; dy = 0; } 
                else if (keyPressed === 'ArrowRight' && direction !== 'LEFT') { direction = 'RIGHT'; dx = 1; dy = 0; }
            }
        }
        
        function showDifficultyScreen() {
            difficultyScreen.style.display = 'flex';
            gameOverScreen.style.display = 'none';
            statsContainer.style.visibility = 'hidden';
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        document.addEventListener('keydown', handleKeyPress);
        restartButton.addEventListener('click', initializeGame);
        changeDifficultyBtn.addEventListener('click', showDifficultyScreen);
        pauseBtn.addEventListener('click', togglePause);

        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                initialSpeed = parseInt(button.dataset.speed);
                initializeGame();
            });
        });
        
        // Touch control event listeners
        document.getElementById('up').addEventListener('click', () => { if (direction !== 'DOWN') { direction = 'UP'; dx = 0; dy = -1; } });
        document.getElementById('down').addEventListener('click', () => { if (direction !== 'UP') { direction = 'DOWN'; dx = 0; dy = 1; } });
        document.getElementById('left').addEventListener('click', () => { if (direction !== 'RIGHT') { direction = 'LEFT'; dx = -1; dy = 0; } });
        document.getElementById('right').addEventListener('click', () => { if (direction !== 'LEFT') { direction = 'RIGHT'; dx = 1; dy = 0; } });

        showDifficultyScreen();
    </script>
</body>
</html>
